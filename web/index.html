<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apicall Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Favicon SVG encoded -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>游</text></svg>">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">游</div>
                <h1>Apicall</h1>
            </div>

            <nav>
                <button class="nav-item active" onclick="showView('dashboard')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    Dashboard
                </button>
                <button class="nav-item" onclick="showView('proyectos')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                    </svg>
                    Proyectos
                </button>
                <button class="nav-item" onclick="showView('troncales')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Troncales
                </button>
                <button class="nav-item" onclick="showView('testcall')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    Probar Llamada
                </button>
                <button class="nav-item" onclick="showView('reports')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Reportes
                </button>
                <button class="nav-item admin-only" onclick="showView('audios')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                    </svg>
                    Audios
                </button>
                <button class="nav-item admin-only" onclick="showView('users')">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    Usuarios
                </button>
            </nav>

            <div class="server-status">
                <div class="status-indicator online"></div>
                <span>Server Online</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header>
                <h2 id="page-title">Dashboard</h2>
                <div class="user-profile">
                    <div style="text-align:right">
                        <div id="user-name-display" style="font-weight:bold">Admin</div>
                        <span id="user-role-badge" class="badge"
                            style="font-size:0.7rem; background:#3b82f6">ADMIN</span>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()"
                        style="padding: 5px 10px; margin-left:10px">Salir</button>
                </div>
            </header>

            <!-- Views -->

            <!-- Dashboard View -->
            <div id="view-dashboard" class="view active">
                <div class="stats-grid">
                    <div class="card stat-card">
                        <h3>Proyectos Activos</h3>
                        <p class="stat-value" id="dash-projects-count">-</p>
                    </div>
                    <div class="card stat-card">
                        <h3>Troncales SIP</h3>
                        <p class="stat-value" id="dash-trunks-count">-</p>
                    </div>
                    <div class="card stat-card">
                        <h3>Llamadas Hoy</h3>
                        <p class="stat-value">--</p> <!-- Placeholder, needs API -->
                    </div>
                </div>
            </div>

            <!-- Proyectos View -->
            <div id="view-proyectos" class="view">
                <div class="toolbar">
                    <button class="btn btn-primary" onclick="openModal('modal-proyecto')">+ Nuevo Proyecto</button>
                </div>
                <div class="card table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Caller ID</th>
                                <th>Troncal</th>
                                <th>AMD</th>
                                <th>Smart CID</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table-proyectos-body">
                            <!-- JS populated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Troncales View -->
            <div id="view-troncales" class="view">
                <div class="toolbar">
                    <button class="btn btn-primary" onclick="openModal('modal-troncal')">+ Nueva Troncal</button>
                </div>
                <div class="card table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Host</th>
                                <th>Usuario</th>
                                <th>Contexto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table-troncales-body">
                            <!-- JS populated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Test Call View -->
            <div id="view-testcall" class="view">
                <div class="card form-card">
                    <h3>Generar Llamada de Prueba</h3>
                    <form id="form-testcall" onsubmit="handleTestCall(event)">
                        <div class="form-group">
                            <label>Proyecto</label>
                            <select id="call-proyecto-id" required>
                                <option value="">Seleccione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>N칰mero Destino</label>
                            <input type="text" id="call-number" placeholder="Ej: 573001234567" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Llamar Ahora</button>
                    </form>
                    <div id="call-result" class="alert" style="display:none; margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Users View -->
            <div id="view-users" class="view">
                <div class="toolbar">
                    <button class="btn btn-primary" onclick="openModal('modal-user')">+ Nuevo Usuario</button>
                </div>
                <div class="card table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Nombre</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table-users-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Reports View -->
            <div id="view-reports" class="view">
                <div class="card" style="margin-bottom: 20px;">
                    <h3>Filtros de Reporte</h3>
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr auto;">
                        <div class="form-group">
                            <label>Proyecto</label>
                            <select id="report-proyecto-filter">
                                <option value="">Todos los Proyectos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Fecha Desde</label>
                            <input type="date" id="report-date-from">
                        </div>
                        <div class="form-group">
                            <label>Fecha Hasta</label>
                            <input type="date" id="report-date-to">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="loadReports()">游댌 Buscar</button>
                        </div>
                    </div>
                </div>
                
                <div class="card table-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>Resultados</h3>
                        <div id="report-stats" style="font-size: 0.9rem; color: #666;"></div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Proyecto</th>
                                <th>Tel칠fono</th>
                                <th>Estado</th>
                                <th>Resultado</th>
                                <th>Interacci칩n</th>
                                <th>Duraci칩n</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="table-reports-body">
                            <tr>
                                <td colspan="8" style="text-align:center">Seleccione los filtros y haga clic en Buscar</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Audios View -->
            <div id="view-audios" class="view">
                <div class="toolbar">
                    <button class="btn btn-primary" onclick="document.getElementById('audio-file-input').click()">游닋
                        Subir Audio</button>
                    <input type="file" id="audio-file-input" accept=".wav,.gsm,.ulaw,.alaw,.sln,.mp3"
                        style="display:none" onchange="handleAudioUpload(event)">
                </div>
                <div class="card table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Tama침o</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table-audios-body">
                            <tr>
                                <td colspan="4" style="text-align:center">Cargando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->

    <!-- Modal Proyecto -->
    <div id="modal-proyecto" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modal-proyecto')">&times;</span>
            <h2>Nuevo Proyecto</h2>
            <form id="form-proyecto" onsubmit="handleCreateProyecto(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID</label>
                        <input type="number" name="id" required>
                    </div>
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label>Caller ID</label>
                        <input type="text" name="caller_id">
                    </div>
                    <div class="form-group">
                        <label>Troncal Salida</label>
                        <input type="text" name="troncal_salida">
                    </div>
                    <div class="form-group">
                        <label>Prefijo</label>
                        <input type="text" name="prefijo_salida">
                    </div>
                    <div class="form-group">
                        <label>Audio</label>
                        <input type="text" name="audio">
                    </div>
                    <div class="form-group">
                        <label>Desborde</label>
                        <input type="text" name="num_desborde">
                    </div>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" name="amd_active"> Activar AMD
                    </label>
                </div>
                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" name="smart_active"> Activar Smart CID
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('modal-proyecto')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Troncal -->
    <div id="modal-troncal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modal-troncal')">&times;</span>
            <h2>Nueva Troncal</h2>
            <form id="form-troncal" onsubmit="handleCreateTroncal(event)">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" name="nombre" required>
                </div>
                <div class="form-group">
                    <label>Host / IP</label>
                    <input type="text" name="host" required>
                </div>
                <div class="form-group">
                    <label>Puerto</label>
                    <input type="number" name="puerto" value="5060">
                </div>
                <div class="form-group">
                    <label>Usuario</label>
                    <input type="text" name="usuario">
                </div>
                <div class="form-group">
                    <label>Contrase침a</label>
                    <input type="text" name="password">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('modal-troncal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal User -->
    <div id="modal-user" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modal-user')">&times;</span>
            <h2>Nuevo Usuario</h2>
            <form id="form-user" onsubmit="handleCreateUser(event)">
                <div class="form-group">
                    <label>Usuario (Login)</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>Contrase침a</label>
                    <input type="password" name="password" required>
                </div>
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" name="full_name" required>
                </div>
                <div class="form-group">
                    <label>Rol</label>
                    <select name="role">
                        <option value="admin">Administrador</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="viewer">Solo Lectura</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modal-user')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Usuario</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>